<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
This is an example weekly progress report document that team members can use to report their individual progress 
of their ECE477 senior design projects. Weekly progress reports are expected to follow the general guidelines
presented in the "Progress Report Policy" document, available online at https://engineering.purdue.edu/ece477/Course/Policies/policies.html

Please create 4 copies of this example, renaming each copy to <PurdueID>.html, where <PurdueID> corresponds to
the Purdue ITAP Career Account ID given by Purdue to each individual team member. If you have any questions,
contact course staff.
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!--Reconfigurable base tag; used to modify the site root location for root-relative links-->
<base href="https://engineering.purdue.edu/477grp6/" />

<!--Content-->
<title>ECE477 Course Documents</title>
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="author" content="George Hadley">
<meta name = "format-detection" content = "telephone=no" />
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!--CSS-->
<link rel="stylesheet" href="css/default.css" type="text/css" media="all" />
<link rel="stylesheet" href="css/responsive.css">
<link rel="stylesheet" href="css/styles.css">
<link rel="stylesheet" href="css/content.css">
<!--[if IE 6]>
<link href="default_ie6.css" rel="stylesheet" type="text/css" />
<![endif]-->

</head>
<body>
<div id="wrapper_site">
    <div id="wrapper_page">
	<!-- Instantiate global site header.-->
	<div id="header"></div>
		<!-- Instantiate site global navigation bar.-->
		<div id="menu"></div>
	
		<!-- Instantiate a page banner image. Page banner images should be 1100x350px and should be located within the local
			img folder located at this directory level. -->
		<div id="banner">
			<img src="Files/img/BannerImgExample.jpg"></img>
		</div>
	
		<!-- Instantiate "tools" needed for a page. Tools are premade functional blocks that can be used to build a page,
			and include things such as a file lister (for listing out homework assignments or tutorials)
		-->
		<div id="content">
            <h2>Progress Report for Isaac Hagedorn</h2>
            
            <!--<h4>Week 1:</h4>
            <b>Date:</b> -Enter today's date here-<br>
            <b>Total hours:</b> -Enter the number of hours you worked this week here-<br>
            <b>Description of design efforts:</b><br>
            -Discuss your design efforts here. Remember to follow the guidelines presented in the Progress Report Policy, available <a href="https://engineering.purdue.edu/ece477/Course/Policies/">here</a>. This is a template entry; simply copy/paste this entry when doing progress reports each week.</br>
	--!>
            <br>

		<h4>Week 2:</h4>
		<b>Date:</b> 9/3<br>
		<b>Total hours:</b> 10<br>
		<b>Description of design efforts:</b><br>
    	<br>This week I worked on standing up some basic testing environments/circuitry for Bluetooth testing as well as driver development testing on an STM32L0 microcontroller. 
	The goal for this week was to setup the development environment for the microcontroller and Bluetooth chip. 
	I worked first on setting up the testing environment for the microcontroller using LEDs to test my microcontroller drivers including initializing the GPIO registers, initializing the non-specific timer registers, and configuring individual pins for different modes. 
	I wrote the drivers with the intention of being able to easily bypass the low-level coding of bit operations and converting those into higher level functions. 
	I tested these drivers by setting up a simple LED circuit that toggled on and off LEDs with different timing initiatives if necessary. 
	Additionally, I completed writing drivers for setting up the ADC and SPI peripherals, but I have yet to begin testing for those.</br>
	<br><img src="Team/progress/ihagedorn/img/bluetooth.jpg" style="width:75%;height:50%;"></br>
	<br>
	For the Bluetooth testing, I setup a simple LED circuit, seen below, with an Arduino Uno that can turn on and off LEDS via wireless commands. 
	The incorporates an HC-05 which communicates with another Bluetooth device such as an Android phone to wirelessly transmit terminal commands.</br>
	<br>
	In addition to writing drivers and Bluetooth testing code, I also assisted in setting up the actual microcontroller development environment configurations in Eclipse and Github code repositories for the website, software code, and embedded software code. 
	During this time, I ran into several issues with the Eclipse environment and being able to flash the target device with built target over SWD. 
	The flashing of our microcontroller on a breakout board currently runs into an issue which results in unreliably flashing the device with about a 50 percent success rate while using the reset button. 
	The current theory is that this is a hardware issue with the breakout board, but further analysis will be needed to confirm this.</br>
</br>
	<br>
		<h4>Week 3:</h4>
		<b>Date:</b> 9/10<br>
		<b>Total hours:</b> 11 <br>
		<b>Description of design efforts:</b><br>
	<br>
	This week was a bit slow since I was wrapped up in several club events and other various commitments.
	After starting the drivers last week, I was able to finish drivers for using the ADC and PWM with the DevBoard. 
	These drivers are tested and ready for capability testing with actual components such as a stepper motor and potentiometer for frequency tests and proof-of-concept tests. 
	Additionally, I received our Bluetooth chip this week and spent a considerable amount of time on board bring-up and integrating it into my original test setup for the HC-05. 
	This included checking the different pins on the breakout board and interfacing with chip with AT commands.
	</br>
	<br>
	On our microchip, I worked on resolving a flashing issue. 
	I began my debugging adventure verifying various connections on the bread board and researching the SWD protocol with STM32. 
	After verifying that all the breadboard connections checked out and the soldering points looked solid under a microscope, I brought up a new software environment in eclipse and tested it with the DevBoard. 
	Eventually I discovered that the debug configurations for our original environment was linked to the wrong ELF file and there have been zero issues flashing the chip henceforth.
	</br>
	<br>
	In addition to embedded development, I also helped out with project component analysis and software overview for this week. 
	In the project component analysis, I provided research and analysis for the Bluetooth chip selection and microcontroller selection. 
	Additionally, I helped create a state machine diagram below for our state logic and provided further details of the microcontroller’s operations within the project.
	<br><img src="Team/progress/ihagedorn/img/State.png" style="width:65%;height:50%;"></br> 
	
</br>
	<br>
		<h4>Week 4:</h4>
		<b>Date: </b> 9/17<br>
		<b>Total hours: </b>15<br>
		<b>Description of design efforts: </b><br>
	<br>
	This week was mostly focused on setting up SPI, I2C, Bluetooth/UART, and testing. 
	I spent a majority of the week debugging the ZB7412-00 Bluetooth Low Energy chip since it didn’t seem to want to cooperate with my repeated attempts to interface with it over UART. 
	I have also tried re-flashing the chip with the production software using a provided SDK and IDE over J-Link; however, outside of the observed availability signals on the two JTAG pins, I can’t seem to get the chip to communicate. 
	Moving forward I’m looking to hookup every pin to a scope and recording its activity on power-up to see what is and isn’t happening. 
	<br>
	<br>
	Additionally, this week I worked on setting up the drivers and testing out the MCU’s SPI and I2C protocols in order to interface and command our IMU. 
	With the completion of these drivers I should be mostly finished with driver development and can move forward with creating header files along with integrating our pin mapping header file with these drivers. 
	I’m currently working on developing some SPI and I2C tests so that I can watch the signals over a scope and confirm their functionalities. 
	Additionally, I have been researching the commanding structure for the IMU so that I know what data to send it. 
	I currently have a detailed address mapping for for the IMU, but I have yet to come across how to command it using SPI.
	<br>
	<br>
	Finally, I worked on a macro test that integrated the drivers for the GPIOs, ADC, PWM, and timers into singular task, control the duty cycle of a LED using a potentiometer. 
	This setup is pictured below and can realistically control the frequency of the LED at a step size of about 0.7 mV as the potentiometer spans from 0 to 3 volts. 
	<br><img src="Team/progress/ihagedorn/img/breadboard.jpg" style="width:65%;height:50%;"></br>
	<br>
	On the non-technical side, I helped with the calculations for the different communication rates for the electrical overview and helped out on several bill of materials entries.
	<br>
	<br>
	Next week I hope to finalize SPI and I2C testing and resolve my Bluetooth development issue. 
	</br>
</br>
	<br>
		<h4>Week 5:</h4>
		<b>Date: </b> 9/24<br>
		<b>Total hours: </b>15<br>
		<b>Description of design efforts: </b><br>
	<br>
	This week was nothing glamorous or pretty. 
	It was mostly brute forcing code and debugging the results in order to understand what was going wrong with the Bluetooth and IMU interfacing.  
	At the start of the week we were working on talking to the Bluetooth chip over serial communication and talking to the IMU over SPI.  
	<br>
	<br>
	After working through multiple datasheets for the ZB7412-00 and not seeing any activity on any of the pins, I tested the current draw of the chip and found that the draw was 0 amperes. 
	As a result, we changed over to the RN4020 which I had previously interfaced with in weeks 2 and 3. 
	The interfacing of this chip over a serial connection can be seen in the figure below, and includes various ASCII commands to setup the chip, advertise, bond, and stand up the connection.
	<br><img src="Team/progress/ihagedorn/img/Serial1.jpg" style="width:65%;height:50%;"><br>
	<br>
	The second accomplishment of the week was interfacing with the IMU over SPI. After, once again, digging through multiple datasheets. 
	I was able to get the IMU to interface with an Arduino using a prebuilt library and one key assumption. 
	The assumption is that since the SPI pins share in common with the I2C pins that I have to use a similar commanding structure to I2C over the SPI lines in order for it to register mu commands.
	The results of this interface can be seen in the data output on the serial monitor below.
	I haven’t yet figured out the why this is the case, but I hope to make progress on this and commanding the IMU with the STM32 over the next week. 
	Additionally I hope, to begin integrating the analog event detector and other subsystems together next week or work with Zach on sensor fusion and Bluetooth packaging.
	<br><img src="Team/progress/ihagedorn/img/serial2.jpg" style="width:65%;height:50%;"><br>
</br>   
	<br>
		<h4>Week 6:</h4>
		<b>Date: </b> 10/1<br>
		<b>Total hours: </b>16<br>
		<b>Description of design efforts: </b><br>
	<br>
	This week, I was finally able to interface with each chip from the STM32. 
	After way too much time debugging, I was finally able to receive back the correct WHO_AM_I response from the IMJU pictured below. 
	I’m not completely sure what the actual issue was; rather, I kept addressing a series of possible issues until I was able to see the correct response. 
	The first issue I noticed was that the SPI was not acting as expected; rather, it was behaving like an I2C protocol with two data lines which responded at erratic times. 
	I resolved this issue by allowing my Arduino Due to talk with the chip and permanently setting several bits that disabled the I2C and persistently enabled the SPI lines. 
	The next issue I resolved was the polarity. 
	I had to set another bit in the configuration register in order to establish the polarity; otherwise I presume the polarity is in some undetermined state. 
	The last issue I noticed was the coupling of the NSS and MOSI lines. 
	To resolve this issue I realized that although the chip was grounded the lines still seemed to be floating, so I added an additional ground line and the lines seemed to finally separate. 
	<br><img src="Team/progress/ihagedorn/img/SPI_Scope.png" style="width:65%;height:50%;"><br>
	<br>
	While I was debugging the IMU interfacing, I also set up drivers for the UART peripheral in order to print out messages and values from the IMU. 
	This peripheral will be used with the BLE chip to command it. 
	Later in the week, I was able to use the UART to configure the RN-4020 which is our new BLE chip after having several unresolvable issues with the ZB7412. 
	I am able to configure the chip properly and connect; however, I sporadically lose connection and I’m still figuring out how to pack floats into packets to put in the air. 
	<br>
	<br>
	Lastly, I worked on starting the software formalization for next week. 
	This week I worked on collecting information for all of our third-party software libraries and laying out our testing plan for each chip and unti testing for the drivers. 
	I believe that most of testing will surround the IMU data collection and BLE dropped connection handling.<br>
</br>
	<br>
		<h4>Week 7:</h4>
		<b>Date: </b> 10/8<br>
		<b>Total hours: </b> 20<br>
		<b>Description of design efforts: </b><br>
	<br>
	This week was fast paced with a lot of great progress toward laying out the full product on the breadboard. 
	At the end of this week, I had three major achievements: Software Formalization/Planning, Completing the breadboard layout, and sending packets over Bluetooth between two chips.
	<br>
	<br>
	This accomplishment of the week was the Bluetooth communication between two BLE chips (One in central mode and one in peripheral mode). 
	This is a big step toward communicating with the computer over Bluetooth since both ends were being commanded by an MCU for now. 
	The issue I learned was that the RN4020 BLE chip required an extra hardware signal to flip it into the MLDP mode and begin transmitting and receiving data as opposed to CMD mode which allows the user to configure the chip
	This revelation allowed me to communicate between an Arduino and the STM with two BLE chips in-between.
	<br>
	<br>
	The second accomplishment of the week was the completion of the breadboard layout with the corresponding code for individual portions of the project. 
	I was finally able to layout all the ICs, potentiometer, and LEDs on one board and test portions separately pictured below.
	This step also allowed me to finish the pinout description for the STM, pictured below, which needed to be finalized for the PCB.
	The next step will be integrating each portion together and ensuring nothing breaks. 
	<br>><img src="Team/progress/ihagedorn/img/breadboard2.jpg" style="width:65%;height:50%;"><br>
	<br>><img src="Team/progress/ihagedorn/img/pinout.png" style="width:65%;height:50%;"><br>
	<br>
	The last achievement of the week was the Software Formalization and Planning.
	I feel very comfortable with the testing plan that I laid out for each portion of the project and the development yet to come.
	Additionally, within this document I characterized each software component, its role, and plans for development internally/externally. 
	<br>
	<br>
	Next week is Fall Break and design reviews and I will look to work on preparing for that along with continuing development on packet structures and improving communication for Bluetooth.
 <br>
             
        </div>
	
		<!-- Instantiate global footer. Any changes to the footer should be made through the top-level file "footer.html" -->
		<div id="footer"></div>
    </div>
</div>

<!--JS-->
<script src="js/jquery.js"></script>
<script src="js/jquery-migrate-1.1.1.js"></script>

<script type="text/javascript">
$(document).ready(function() {
    $("#header").load("header.html");
	$("#menu").load("navbar.html");
	$("#footer").load("footer.html");
});
</script>
</body>
</html>
